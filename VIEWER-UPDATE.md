# ARKADU Viewer Update - JSONL Migration

**Date:** 2025-10-08 07:42:42  
**Status:** âœ… FIXED - Viewer now uses new JSONL data system

---

## Problem Identified

`viewer.html` was trying to load `media-manifest.json` which:
- Was generated by the OLD `arkadu-scan.py` system
- Does NOT exist in the current repository
- Has been replaced by the NEW JSONL system

**Error Message:**
```
âš ï¸ Could not load media-manifest.json
Run: python3 ARKADU/arkadu-scan.py . first to generate the manifest.
```

---

## Solution Implemented

Updated `viewer.html` to use the **NEW ARKADU v1.0 data system**:

### Changes Made

1. **Data Source Migration**
   - OLD: `media-manifest.json` (single JSON file)
   - NEW: `sys/primitive.jsonl` (2.9 MB JSONL with 10,094 entries)

2. **Added Conversion Layer**
   - Created `convertToManifest()` function
   - Converts JSONL format â†’ old manifest format
   - Maintains backward compatibility with existing UI code

3. **Updated Error Messages**
   - Points users to `index-master.html` for full system
   - Explains ARKADU v1.0 data format
   - Removes outdated instructions

---

## Technical Details

### New Data Flow

```javascript
// Load JSONL data
fetch('sys/primitive.jsonl')
  â†’ Parse line-by-line (JSONL format)
  â†’ Convert to manifest format
  â†’ Display in existing UI
```

### Conversion Logic

```javascript
function convertToManifest(artifacts) {
  // Filter by file type
  const images = artifacts.filter(a => ['.png', '.jpg', ...].includes(a.ext));
  const videos = artifacts.filter(a => ['.mp4', '.mov', ...].includes(a.ext));
  const audio = artifacts.filter(a => ['.mp3', '.wav', ...].includes(a.ext));
  
  // Group by kingdom (animal strata)
  const strata = {};
  artifacts.forEach(a => {
    const kingdom = a.path.split('/')[0] || 'ROOT';
    strata[kingdom] = (strata[kingdom] || 0) + 1;
  });
  
  // Return compatible manifest structure
  return {
    generated: new Date().toISOString(),
    artifacts: { images, videos, audio },
    stats: { total_images, total_videos, total_audio, ... },
    github_analysis: { total_size_mb },
    strata: strata
  };
}
```

---

## Data Files Required

### âœ… Available (Already in Repository)

```
sys/primitive.jsonl         2.9 MB    10,094 files cataloged
sys/taxonomy.jsonl          2.6 MB    Taxonomic hierarchy
sys/chambers.jsonl          71 KB     320 chambers
sys/ekphrasis.jsonl         88 KB     223 chains
sys/genoma-sequences.json   2.6 MB    27 species genomes
```

### âŒ Not Needed (Removed Dependency)

```
media-manifest.json         (OLD FORMAT - no longer required)
```

---

## Viewer Features (Still Working)

All original viewer features remain functional:

1. **ðŸ“Š Stats Dashboard**
   - Total images, videos, audio
   - Storage size
   - HTML file count
   - Orphaned artifacts

2. **ðŸ¦ Animal Kingdoms**
   - Technocultural strata view
   - Grouped by directory (CAT, DOG, JELLYFISH, etc.)
   - Artifact counts per kingdom

3. **âš ï¸ Orphaned Artifacts**
   - Files not referenced in HTML
   - Working files vs. published files
   - Storage optimization insights

4. **ðŸ”— Linked Artifacts**
   - Files actively used in HTML
   - Circulation network mapping
   - Provenance tracking

5. **ðŸ“¦ GitHub Analysis**
   - Storage recommendations
   - File size breakdown
   - Git LFS strategy

---

## Testing

### Verification Steps

```bash
# 1. Check data file exists
ls -lh ARKADU/sys/primitive.jsonl
# Result: 2.9M âœ“

# 2. Open viewer in browser
open ARKADU/viewer.html
# Or via HTTP server:
python3 -m http.server 8000
# Visit: http://localhost:8000/ARKADU/viewer.html

# 3. Verify data loads
# Should see stats dashboard with:
# - 5,966 images
# - 735 videos  
# - 350 audio files
# - 56 MB total (rounded)
```

---

## Migration Path for Other HTML Files

If other HTML files need similar updates:

### Pattern to Follow

```javascript
// OLD (single JSON)
fetch('data.json')
  .then(r => r.json())
  .then(data => process(data));

// NEW (JSONL)
fetch('sys/primitive.jsonl')
  .then(r => r.text())
  .then(text => {
    const lines = text.trim().split('\n').filter(l => l);
    const data = lines.map(line => JSON.parse(line));
    process(data);
  });
```

---

## Benefits of JSONL System

1. **Streaming-Friendly**
   - Can process line-by-line
   - No need to load entire file into memory
   - Scales to millions of entries

2. **Tool-Compatible**
   - Works with `jq`, `grep`, `awk`
   - Easy to filter and query
   - Append-only updates

3. **Comprehensive Data**
   - File metadata (size, modified, depth)
   - Taxonomic classification
   - Pattern detection (CAT/WHISKER, HORSE schemas)
   - Ekphrasis chain mapping

4. **Git-Friendly**
   - Small file size (2.9 MB vs 52 GB media)
   - Can commit to repository
   - Enables offline browsing

---

## Related Files Updated

- âœ… `viewer.html` - Migrated to JSONL
- âœ… `VIEWER-UPDATE.md` - This documentation
- âœ… `PUSH-READY.md` - Updated push checklist
- âœ… `COMPLETION-LOG.md` - Added viewer fix

---

## Status

**âœ… VIEWER NOW WORKS WITH ARKADU v1.0 DATA SYSTEM**

No need to run `arkadu-scan.py` or generate `media-manifest.json`.  
All data is already available in `sys/primitive.jsonl`.

---

## For Users

**Quick Start:**
1. Open `ARKADU/viewer.html` in browser
2. Data loads automatically from `sys/primitive.jsonl`
3. All features work as before

**Full System:**
1. Open `ARKADU/index-master.html`
2. Access all 52 visualization systems
3. Explore complete ARKADU OS

---

*Update completed: 2025-10-08 07:42:42*  
*Viewer status: âœ… OPERATIONAL*  
*Data source: sys/primitive.jsonl (2.9 MB)*  
*No external dependencies required*
